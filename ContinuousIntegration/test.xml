<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="DoItAll" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" >

  <Import Project="properties.xml" />

  <PropertyGroup>
    <SolutionRoot>$(MSBuildProjectDirectory)\..\</SolutionRoot>
    <MSBuildCommunityTasksPath>$(SolutionRoot)\tools\msbuild\MSBuildCommunityTasks\</MSBuildCommunityTasksPath>
  </PropertyGroup>
  <Import Project="$(MSBuildCommunityTasksPath)\MSBuild.Community.Tasks.Targets"/>
  <UsingTask TaskName="SetEnvVariable"
             AssemblyFile="$(SolutionRoot)\tools\MSBuild.SetEnvVariable\MSBuild.SetEnvVariable.dll"/>

  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Release</Configuration>
    <NUnitPath>$(SolutionRoot)\packages\NUnit.2.5.10.11092\tools\</NUnitPath>

    <AppMetricsTest_ServiceRootUrl Condition="$(AppMetricsTest_ServiceRootUrl_Versioned) != ''"
                                   >$(AppMetricsTest_ServiceRootUrl_Versioned)_$(MyBuildNumber)</AppMetricsTest_ServiceRootUrl>
    <AppMetricsTest_ServiceRootUrl Condition="$(AppMetricsTest_ServiceRootUrl_Versioned) == ''"
                                   >$(AppMetricsTest_ServiceRootUrl)</AppMetricsTest_ServiceRootUrl>
  </PropertyGroup>

  <Target Name="Test" >
    <SetEnvVariable Name="AppMetricsTest_ServiceRootUrl" Value="$(AppMetricsTest_ServiceRootUrl)"/>
    <SetEnvVariable Name="AppMetricsTest_UserName" Value="$(AppMetricsTest_UserName)"/>
    <SetEnvVariable Name="AppMetricsTest_Password" Value="$(AppMetricsTest_Password)"/>
    
    <CreateItem Include="$(SolutionRoot)\_bin\$(Configuration)\Tests.dll">
      <Output TaskParameter="Include" ItemName="TestAssembly1" />
    </CreateItem>
    <NUnit ToolPath="$(NUnitPath)" DisableShadowCopy="true" Assemblies="@(TestAssembly1)" />
    
    <CreateItem Include="$(SolutionRoot)\_bin\$(Configuration)\Tests.Analytics.dll">
      <Output TaskParameter="Include" ItemName="TestAssembly2" />
    </CreateItem>
    <NUnit ToolPath="$(NUnitPath)" DisableShadowCopy="true" Assemblies="@(TestAssembly2)" />
  </Target>

  <Target Name="DoItAll" DependsOnTargets="Test" >
  </Target>

</Project>
